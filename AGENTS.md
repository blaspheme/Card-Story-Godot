# Rules for Agents

## 开发流程

1. 首先和我确认：需求细化描述、技术方案
2. 当前 godot 版本为 4.5.1，在需要的时候可以使用 mcp_context7 里的工具查询官方文档。
3. 编码完成后，运行 godot --headless 命令并修正 log 中的错误，确保游戏能正常编译运行。（注意！你不具备操作游戏的能力，所以你测试不了任何游戏内的游玩逻辑，你只能也只需确保游戏能正常编译运行即可）
4. 最后在 docs 中更新游戏逻辑文档和技术实现方案文档

## 代码风格

- 添加大量中文注释。但**严禁**添加任何修改日志式的注释，例如"x 已移除"或者"x 优化为 y"
- **永远**使用 tabs 缩进，以避免空格和 tab 混合错误
- **彻底移除**因为需求变更而废弃的代码
- **严禁**使用 has_method、has_node、is_instance_valid 等动态容错手段来绕过类型或节点存在性检查。任何需要调用的方法必须通过静态设计保证（如明确的类型声明、继承接口、或在 \_ready 中断言节点存在）。如果方法/节点缺失，应当抛出错误或断言失败，而不是静默跳过。

## 代码设计原则

- **DRY（Don't Repeat Yourself，不要重复）**

  - 相同或相似逻辑不要在多个地方重复出现。
  - 通过函数、类或模块抽象来消除重复。

- **KISS（Keep It Simple, Stupid，保持简单）**

  - 能用简单的实现就不要引入复杂抽象。
  - 避免过度设计，优先保证清晰易懂。

- **YAGNI（You Aren’t Gonna Need It，你不会需要它）**

  - 不要提前实现未来可能用到的功能。
  - 仅在确实需要时才编写或扩展代码。

- **SOLID 原则**
  - **S: 单一职责** — 每个类或模块只负责一件事。
  - **O: 开放封闭** — 对扩展开放，对修改封闭。
  - **L: 里氏替换** — 子类必须能替代父类。
  - **I: 接口分离** — 不要强迫实现不需要的接口。
  - **D: 依赖倒置** — 高层模块不依赖底层实现，而依赖抽象。

## 其他重要原则（这一部分非常个性化，请按你的项目需求重写，只在反复遇到同一问题时添加）

- 游戏调色盘在 GameStyle.gd 中统一管理
- 游戏机制和平衡性参数在 GameConfig.gd 中统一管理。除非显式要求，否则不需要添加机制开关参数。样式和动效参数不要放到 GameConfig.gd 或 GameStyle.gd，在具体文件顶部定义即可
- 组件间通信永远使用 EventBus，不要直接相互调用
- 所有粒子效果都要关闭重力影响
- 复杂粒子效果必须预热