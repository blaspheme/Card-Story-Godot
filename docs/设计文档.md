# 设计文档
- 重新设计系统架构: Data–System–Rule + UI + Component/Behavior + FSM

架构

```
 ┌────────────────────────────────────────────────────┐
 │                      Data 层                       │
 │────────────────────────────────────────────────────│
 │ CardData.tres                                       │
 │   ├ name = "Passion"                                │
 │   ├ behaviors = [DecayBehaviorData, GenerateBehaviorData] 
 │   └ icon = "res://icon_passion.png"                 │
 │                                                    │
 │ BehaviorData（定义行为类型与参数）                   │
 │   ├ behavior_id = "decay"                           │
 │   └ params = {"rate": 0.1}                          │
 └────────────────────────────────────────────────────┘
						   │
						   ▼
 ┌────────────────────────────────────────────────────┐
 │                     State 层                       │
 │────────────────────────────────────────────────────│
 │ CardState                                           │
 │   ├ data: CardData                                  │
 │   ├ age: float                                      │
 │   ├ expired: bool                                   │
 │   └ position: Vector2                               │
 │                                                    │
 │ CardState 是运行时实体，保存当前状态。               │
 │ 它不包含逻辑，只是状态快照。                        │
 └────────────────────────────────────────────────────┘
						   │
						   ▼
 ┌────────────────────────────────────────────────────┐
 │                    System 层                       │
 │────────────────────────────────────────────────────│
 │ BehaviorSystem                                     │
 │   ├ registry = {                                   │
 │   │    "decay": func(state, params): ...           │
 │   │    "generate": func(state, params): ...        │
 │   │  }                                             │
 │                                                    │
 │   apply_behaviors(state):                          │
 │       for b in state.data.behaviors:               │
 │           handler = registry[b.behavior_id]        │
 │           handler.call(state, b.params)            │
 │                                                    │
 │ 逻辑集中在 System 层，可被全局调用。                │
 │ 不依附具体节点，不直接引用 UI。                    │
 └────────────────────────────────────────────────────┘
						   │
						   ▼
 ┌────────────────────────────────────────────────────┐
 │                       UI 层                        │
 │────────────────────────────────────────────────────│
 │ CardUI.gd                                          │
 │   ├ state: CardState                               │
 │   ├ _process(delta):                               │
 │   │    update_visuals_from(state)                  │
 │   └ signal clicked                                 │
 │                                                    │
 │ UI 仅负责渲染和交互，不包含逻辑。                   │
 └────────────────────────────────────────────────────┘
						   │
						   ▼
 ┌────────────────────────────────────────────────────┐
 │                    FSM / GameLoop                  │
 │────────────────────────────────────────────────────│
 │ GameState.gd / VerbSlotFSM.gd                      │
 │   ├ 管理“回合 / 槽位 / 时间流动”等过程              │
 │   ├ 控制何时调用 BehaviorSystem                    │
 │   └ 与 UI 层交互（显示动画、过渡）                 │
 └────────────────────────────────────────────────────┘
```
